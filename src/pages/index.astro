---
import PlotFigure from "../components/PlotFigure.astro";
import Layout from "../layouts/Layout.astro";
import * as Plot from "@observablehq/plot";
import penguins from "../assets/penguins.json";

const { species } = Astro.params;
const validSpecies = ['Adelie', 'Gentoo', 'Chinstrap'];
const currentSpecies = validSpecies.includes(species) ? species : 'Adelie';
---

<Layout>
  <nav class="bg-blue-600 text-white p-4 mb-6">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-xl font-bold">Penguins Data Visualization</h1>
      <div class="space-x-4">
        <a href="/" class="font-bold underline">Accueil</a>
        <a href="/species/Adelie" class="hover:underline">Adelie</a>
        <a href="/species/Gentoo" class="hover:underline">Gentoo</a>
        <a href="/species/Chinstrap" class="hover:underline">Chinstrap</a>
        <a href="/test-inframe" class="hover:underline">Test Iframe</a>
        <a href="/single-page-anchors" class="hover:underline">Page avec ancres</a>
        <a href="/single-page-tabs/" class="font-bold underline">Page avec onglets</a>
      </div>
    </div>
  </nav>

  <main class="container mx-auto px-4">
    <h1 class="text-4xl font-bold mb-8 text-center">
      TP2 - Astro et Plot (Observable)
    </h1>

    <!-- Section d'introduction -->
    <div class="mb-12 text-center">
      <p class="text-lg text-gray-700 mb-6">
        Ce TP explore différentes façons d'organiser et de naviguer entre des
        visualisations de données. Explorez les différentes approches ci-dessous
        :
      </p>
    </div>

    <!-- Cards de navigation -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
      <!-- Card 1: Pages individuelles -->
      <div
        class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow"
      >
        <h3 class="text-xl font-bold mb-3 text-blue-600">
          1. Pages par espèce
        </h3>
        <p class="text-gray-600 mb-4">
          Navigation classique avec une page dédiée à chaque espèce de pingouin.
        </p>
        <div class="flex items-center space-x-2">
          <label for="species-select" class="text-sm">Espèce:</label>
          <select 
            id="species-select" 
            class="bg-white text-black px-3 py-1 rounded border"
          >
            <option value="Adelie" selected={currentSpecies === 'Adelie'}>Adelie</option>
            <option value="Gentoo" selected={currentSpecies === 'Gentoo'}>Gentoo</option>
            <option value="Chinstrap" selected={currentSpecies === 'Chinstrap'}>Chinstrap</option>
          </select>
        </div>
      </div>

      <script>
    document.addEventListener('DOMContentLoaded', function() {
      const speciesSelect = document.querySelector("#species-select");
      
      speciesSelect?.addEventListener("change", (evt) => {
        const value = (evt.target as HTMLSelectElement).value;
        const segments = location.pathname.split("/");
        
        // Assurer que l'URL se termine par /
        const newPath = `/species/${value}/`;
        window.location.href = newPath;
      });
    });
  </script>

      <!-- Card 2: IFrame -->
      <div
        class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow"
      >
        <h3 class="text-xl font-bold mb-3 text-orange-600">
          2. Navigation par IFrame
        </h3>
        <p class="text-gray-600 mb-4">
          Chargement des pages dans un iframe avec redimensionnement
          automatique.
        </p>
        <a
          href="/test-inframe"
          class="block bg-orange-500 text-white px-4 py-2 rounded text-center hover:bg-orange-600"
        >
          Tester l'IFrame
        </a>
      </div>

      <!-- Card 3: Ancres et slider -->
      <div
        class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow"
      >
        <h3 class="text-xl font-bold mb-3 text-red-600">3. Page avec ancres</h3>
        <p class="text-gray-600 mb-4">
          Tous les graphiques sur une page avec navigation par ancres et slider
          horizontal.
        </p>
        <a
          href="/single-page-anchors"
          class="block bg-red-500 text-white px-4 py-2 rounded text-center hover:bg-red-600"
        >
          Page avec ancres
        </a>
      </div>
    </div>

    <!-- Graphique principal (overview) -->
    <div class="bg-gray-50 p-8 rounded-lg">
      <h2 class="text-2xl font-bold mb-6 text-center">
        Vue d'ensemble - Toutes les espèces
      </h2>
      <PlotFigure
        options={{
          title: "Relation entre longueur et profondeur du culmen par espèce",
          marks: [
            Plot.dot(penguins, {
              x: "culmen_length_mm",
              y: "culmen_depth_mm",
              stroke: "species",
              fill: "species",
              fillOpacity: 0.6,
              strokeWidth: 2,
              r: 5,
            }),
          ],
          x: {
            label: "Longueur du culmen (mm)",
            grid: true,
          },
          y: {
            label: "Profondeur du culmen (mm)",
            grid: true,
          },
          color: {
            legend: true,
          },
          width: 800,
          height: 500,
        }}
      />

      <!-- Statistiques -->
      <div class="mt-6 grid grid-cols-3 gap-4 text-center">
        <div class="bg-blue-100 p-4 rounded">
          <h4 class="font-bold text-blue-800">Adelie</h4>
          <p class="text-2xl font-bold text-blue-600">
            {penguins.filter((p) => p.species === "Adelie").length}
          </p>
          <p class="text-sm text-blue-600">individus</p>
        </div>
        <div class="bg-green-100 p-4 rounded">
          <h4 class="font-bold text-green-800">Gentoo</h4>
          <p class="text-2xl font-bold text-green-600">
            {penguins.filter((p) => p.species === "Gentoo").length}
          </p>
          <p class="text-sm text-green-600">individus</p>
        </div>
        <div class="bg-purple-100 p-4 rounded">
          <h4 class="font-bold text-purple-800">Chinstrap</h4>
          <p class="text-2xl font-bold text-purple-600">
            {penguins.filter((p) => p.species === "Chinstrap").length}
          </p>
          <p class="text-sm text-purple-600">individus</p>
        </div>
      </div>
    </div>
  </main>

  <footer class="mt-12 bg-gray-800 text-white p-8">
    <div class="container mx-auto text-center">
      <p class="mb-4">
        TP2 - Visualisation des données des penguins avec Astro et Observable
        Plot
      </p>
      <p class="text-sm text-gray-400">
        Données : Palmer Archipelago (Antarctica) penguin data • Technologies :
        Astro, Observable Plot, Tailwind CSS
      </p>
    </div>
  </footer>
</Layout>
